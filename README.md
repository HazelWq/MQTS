# QW-MQTS

本项目为北京大学光华管理学院2022-2023学年第一学期《当代量化交易系统的原理及实现》课程作业。

## 数据总览
1. Data

   保存原始数据
 - Industry.csv: 2022.11.18的股票行业分类
 - mktcap.csv：2017.11.20-2022.11.18股票市值
 - stockrate.csv：2017.11.20-2022.11.18股票收益率
 - ROE.csv： 2017.11.20-2022.11.18企业ROE比率

2. Factor_realized

    保存计算好的因子；回测系统从中调取需要回测的因子
  - ROE_neutral.csv
    - 经过市值、行业中性化处理的ROE因子（例）


## 文件
1. Choice接口.py
    
    从Choice金融终端的量化接口中导出数据

2. function_lib.py
    
    在构建策略、回测中用到的函数；读取一些必需的文件

3. strategy_sample.py
    
    构建因子策略的文件
    
4. backtest_sys.py
    
    因子回测文件
    
## 使用方式
1. 数据获取
  - 如果有Choice量化接口权限，则可按照Choice接口.py中的范例调取，保存到本地
  - 若没有Choice量化接口权限，则可以通过其他方式建立本地数据库
2. 构建策略
  - 在strategy_sample.py中可读取所需数据、调取所需函数构建因子，最终构建因子存于factor_temp, 保存到Factor_realized中
  - 本文件以经过市值、行业中性化处理的ROE因子为例
  - 如需构建自己的因子和策略，则可以在strategy_sample.py中实现
3. 回测
  - 将需要回测的因子名称赋值给factor_name即可，需保证该因子在Factor_realized中
  - 回测结果包含因子的多空收益曲线、分组收益曲线、因子单调性、因子衰减率、因子截面分布、因子行业暴露
  - 结果将生成图片展示（如有需求可手动保存）
4. function_lib中包含的函数列表
  - 数据处理函数
    - winsorize 对数据进行截尾处理
    - standardize 对数据进行标准化处理
    - filter_null 删去数据中缺失值，仅保留都有数据的样本
    - fill_by_mean 以均值填充缺失值
    - onehot 分类变量转化为onehot矩阵/虚拟变量
    - nanmean_adj 解决np.nanmean遇到全空矩阵时的warning
  - 功能函数
    - neutral 截面上对因子进行中性化处理
    - get_industry_beta 计算因子在行业上的风险暴露
    - group_stock 分组函数，为股票分组以观测每组收益
    - value_line 转化日收益率为净值曲线/累计收益
    - calc_decay 计算因子衰减率，即Corr(F_t, R_t+1+n)
    - figures 对回测结果作图

## 展望
1. 由于本项目开始时间为2022.11.18，故所有数据的截止时间都是2022.11.18；11.18至今新上市了许多股票，A股总数突破了5000，而本项目仅囊括了4700支左右的A股。群里的数据给出得有些晚，没有来得及使用更新、颗粒度更高的数据。
2. function_lib中，有些函数只会在backtest_sys中用到，有些只会在strategy_sample中用到，也许可以再优化结构，使得计算因子的时候只读取计算因子相关的函数，回测的时候只用到回测相关的函数（回测过程本身也可以）
3. 因子衰减率的计算用时较长，也许可以进一步优化
4. 行业分类数据的逐日获取对本人来说较为繁琐，于是假设股票的所在行业不发生变化，在所有截面上都采用最后一个交易日的分类。

欢迎提出意见与建议~
